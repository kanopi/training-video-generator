# /video-automate Command

The `/video-automate` command generates AppleScript automation files that control iTerm2 to execute terminal commands with proper timing for screen recording.

## Overview

This command transforms your beat sheet into executable automation scripts that drive the terminal during recording. It synchronizes command execution with your narration timing.

**Command**: `/video-automate <topic>`

**Allowed Tools**: `Read`, `Write`

## What It Does

1. **Reads Beat Sheet**
   - Parses the beat-by-beat script
   - Extracts terminal commands
   - Notes timing for each beat

2. **Generates AppleScript**
   - Creates iTerm2 automation
   - Adds delays matching narration duration
   - Includes command execution with proper timing

3. **Creates Recording Script**
   - Bash wrapper for screen recording workflow
   - Pre-recording checklist
   - Recording instructions

## Usage

```bash
/video-automate installation-and-setup
```

**Parameters**:
- `<topic>`: The topic name (must have existing beat sheet)

**Prerequisites**:
- Beat sheet must exist at `scripts/video-scripts/[topic]-beat-sheet.md`
- iTerm2 must be installed (macOS only)

## Generated Files

### 1. AppleScript File
**Location**: `scripts/automation/[topic]-automate.scpt`

**Purpose**: Automates iTerm2 to execute commands with timing

**Example**:
```applescript
#!/usr/bin/osascript
-- Automation script for: installation-and-setup
-- Generated by Training Video Generator

tell application "iTerm2"
    -- Create new window with default profile
    create window with default profile

    tell current session of current window
        -- Beat 1: Introduction
        -- Duration: 15 seconds
        delay 15

        -- Beat 2: Check Prerequisites
        -- Duration: 25 seconds
        write text "node --version"
        delay 3
        write text "npm --version"
        delay 3

        -- Beat 3: Create Project Directory
        -- Duration: 20 seconds
        write text "cd ~/Projects"
        delay 2
        write text "mkdir my-project"
        delay 1
        write text "cd my-project"
        delay 3

        -- Continue with remaining beats...
    end tell
end tell

-- Display completion message
display notification "Video recording automation complete!" with title "Training Video Generator"
```

### 2. Recording Script
**Location**: `scripts/automation/[topic]-record.sh`

**Purpose**: Orchestrates the screen recording process

**Example**:
```bash
#!/bin/bash
# Recording script for: installation-and-setup
# Generated by Training Video Generator

set -e

echo "üé¨ Training Video Recording Script"
echo "Topic: installation-and-setup"
echo "Duration: 5 minutes"
echo ""

# Configuration
TOPIC="installation-and-setup"
RECORDING_DIR="recordings"
AUTOMATION_SCRIPT="scripts/automation/${TOPIC}-automate.scpt"

# Pre-recording checklist
echo "üìã Pre-recording checklist:"
echo "  ‚úì Clean terminal environment"
echo "  ‚úì Hide personal information"
echo "  ‚úì Close unnecessary applications"
echo "  ‚úì Prepare any required files"
echo ""

echo "‚ñ∂Ô∏è  To record:"
echo "  1. Press Cmd+Shift+5 to start screen recording"
echo "  2. Select recording area"
echo "  3. Click 'Record'"
echo "  4. Run: osascript $AUTOMATION_SCRIPT"
echo "  5. Wait for automation to complete"
echo "  6. Click stop button in menu bar"
echo "  7. Save as: $RECORDING_DIR/${TOPIC}.mov"
echo ""

read -p "Ready to run automation? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]
then
    echo "üöÄ Running automation script..."
    osascript "$AUTOMATION_SCRIPT"
    echo "‚úÖ Automation complete!"
else
    echo "‚ùå Cancelled"
    exit 1
fi
```

## Recording Workflow

### 1. Prepare Environment

```bash
# Clean terminal
clear

# Set up test environment (if needed)
cd ~/test-recordings

# Close distracting applications
# Hide desktop icons (optional)
# Set terminal to full screen
```

### 2. Start Recording

1. **Press** `Cmd + Shift + 5` (macOS screen recording)
2. **Select** recording area (terminal + browser if needed)
3. **Click** "Record" button
4. **Wait** 2-3 seconds for recording to start

### 3. Run Automation

```bash
osascript scripts/automation/[topic]-automate.scpt
```

The automation will:
- Create new iTerm2 window
- Execute commands with proper timing
- Pause between beats
- Display notification when complete

### 4. Stop Recording

1. **Click** stop button in macOS menu bar
2. **Save** recording as `recordings/[topic].mov`

## Timing Considerations

### Delay Calculation

The script adds delays based on:
- **Narration duration**: Time for TTS audio
- **Command execution**: Time for output to appear
- **User comprehension**: Time to read output

**Example**:
```applescript
-- Beat narration is 15 seconds
-- Add 15 second delay before next command
delay 15

-- Command takes ~2 seconds to complete
write text "npm install"
delay 2

-- Give viewers 3 seconds to see success message
delay 3
```

### Adjusting Timing

If automation runs too fast or slow:

1. **Edit the `.scpt` file** directly
2. **Adjust `delay` values**
3. **Test with short recordings** before full takes

## Configuration

Customize automation in `.training-video-generator/config.json`:

```json
{
  "automation": {
    "terminalApp": "iTerm2",
    "defaultDelay": 2,
    "commandDelay": 1,
    "pauseAfterOutput": 2
  }
}
```

## Platform Support

### macOS (Recommended)
- ‚úÖ Full support with iTerm2
- ‚úÖ AppleScript automation
- ‚úÖ Built-in screen recording (Cmd+Shift+5)

### Linux
- ‚ö†Ô∏è Partial support
- Requires manual terminal scripting
- Use `xdotool` or custom expect scripts
- Screen recording with OBS Studio or SimpleScreenRecorder

### Windows
- ‚ö†Ô∏è Partial support
- Requires PowerShell or AutoHotkey scripts
- Screen recording with built-in Game Bar or OBS Studio

## Tips

1. **Test First**: Run automation without recording to check timing
2. **Clean Environment**: Start with fresh terminal, no history
3. **Font Size**: Increase terminal font for better readability (18-24pt)
4. **Window Size**: Use consistent terminal dimensions
5. **Practice**: Do a few test runs before final recording

## Troubleshooting

### "iTerm2 not found"

**Problem**: AppleScript can't find iTerm2

**Solution**:
```bash
# Check iTerm2 is installed
ls /Applications/iTerm.app

# If not installed
brew install --cask iterm2
```

### "Automation runs too fast"

**Problem**: Commands execute before narration finishes

**Solution**:
- Increase delay values in `.scpt` file
- Add buffer time between beats
- Review beat sheet timing

### "Commands fail during automation"

**Problem**: Commands error out or don't execute

**Solution**:
- Verify commands work manually
- Check working directory is correct
- Ensure prerequisites are met
- Add error handling in script

### "Permission denied"

**Problem**: macOS security blocks automation

**Solution**:
1. Open **System Preferences** ‚Üí **Security & Privacy**
2. Go to **Privacy** tab ‚Üí **Automation**
3. Enable **iTerm2** to control **System Events**

### "Screen recording stops unexpectedly"

**Problem**: macOS stops recording during automation

**Solution**:
- Grant screen recording permission to iTerm2
- System Preferences ‚Üí Security & Privacy ‚Üí Privacy ‚Üí Screen Recording
- Enable iTerm2

## Advanced Usage

### Custom Commands Between Beats

Edit the generated `.scpt` file to add custom behavior:

```applescript
-- Clear screen before next beat
write text "clear"
delay 1

-- Show directory contents with highlighting
write text "ls -la"
delay 4

-- Custom notification
display notification "Starting main installation" with title "Recording"
```

### Conditional Logic

Add conditional execution:

```applescript
-- Check if directory exists before creating
write text "[ -d my-project ] || mkdir my-project"
delay 2
```

### Multi-Window Recording

Control multiple terminal windows:

```applescript
tell application "iTerm2"
    -- Window 1: Server
    tell first window
        tell current session
            write text "npm run dev"
        end tell
    end tell

    -- Window 2: Client commands
    tell second window
        tell current session
            delay 5
            write text "npm run client"
        end tell
    end tell
end tell
```

## Next Steps

After generating automation scripts:

1. **Review** the generated `.scpt` file
2. **Test** automation without recording
3. **Adjust** timing if needed
4. **Record** the video with automation
5. **Save** recording as `recordings/[topic].mov`
6. **Run** `/video-narrate` to generate audio
7. **Run** `/video-merge` to combine video and audio

## Related Commands

- [`/video-script`](video-script.md) - Generate beat sheet (prerequisite)
- [`/video-narrate`](video-narrate.md) - Generate TTS narration
- [`/video-merge`](video-merge.md) - Merge video and audio
- [Workflow Guide](../guides/workflow.md) - Complete production workflow
